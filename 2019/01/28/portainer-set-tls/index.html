<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>Portainer 透過 TLS 認證 - Yi Yang&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="Portainer 是一個輕量級的 UI 管理界面，可輕鬆管理 Docker 主機或 Swarm 叢集，配置遠端管理會使用到Docker API，而預設都會開啟沒有安全保護的 port 2375 產生連線漏洞，而我們就會需要配置TLS認證憑證，以確保連線安全，此篇會說明如何針對新增Endpoints主機配置加入TLS加密。">
<meta name="keywords" content="docker,UI">
<meta property="og:type" content="article">
<meta property="og:title" content="Portainer 透過 TLS 認證">
<meta property="og:url" content="http://yylin1.github.io/2019/01/28/portainer-set-tls/index.html">
<meta property="og:site_name" content="Yi Yang&#39;s Blog">
<meta property="og:description" content="Portainer 是一個輕量級的 UI 管理界面，可輕鬆管理 Docker 主機或 Swarm 叢集，配置遠端管理會使用到Docker API，而預設都會開啟沒有安全保護的 port 2375 產生連線漏洞，而我們就會需要配置TLS認證憑證，以確保連線安全，此篇會說明如何針對新增Endpoints主機配置加入TLS加密。">
<meta property="og:locale" content="zh-TW">
<meta property="og:image" content="http://yylin1.github.io/images/portainer-tls.png">
<meta property="og:updated_time" content="2019-08-07T08:10:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Portainer 透過 TLS 認證">
<meta name="twitter:description" content="Portainer 是一個輕量級的 UI 管理界面，可輕鬆管理 Docker 主機或 Swarm 叢集，配置遠端管理會使用到Docker API，而預設都會開啟沒有安全保護的 port 2375 產生連線漏洞，而我們就會需要配置TLS認證憑證，以確保連線安全，此篇會說明如何針對新增Endpoints主機配置加入TLS加密。">
<meta name="twitter:image" content="http://yylin1.github.io/images/portainer-tls.png">







<link rel="icon" href="/images/artificial-intelligence.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/artificial-intelligence.png" alt="Portainer 透過 TLS 認證" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/gossip">Gossip</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="/tags">Tags</a>
                
                <a class="navbar-item" href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="文章目錄" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜尋" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <!-- 将main_column_class() 改为 col() -->
                <div class="column is-6-tablet is-6-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-image">
        <span class="image is-7by1">
            <img class="thumbnail" src="/images/portainer-tls.png" alt="Portainer 透過 TLS 認證">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-28T14:46:42.000Z">2019-01-28</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Docker/">Docker</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 分鐘 閱讀文 (大約 1985 個字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Portainer 透過 TLS 認證
            
        </h1>
        <div class="content">
            <p>Portainer 是一個輕量級的 UI 管理界面，可輕鬆管理 Docker 主機或 Swarm 叢集，配置遠端管理會使用到Docker API，而預設都會開啟沒有安全保護的 <code>port 2375</code> 產生連線漏洞，而我們就會需要配置TLS認證憑證，以確保連線安全，此篇會說明如何針對<code>新增Endpoints主機</code>配置加入TLS加密。</p>
<a id="more"></a>
<h2 id="Portainer概述"><a href="#Portainer概述" class="headerlink" title="Portainer概述"></a>Portainer概述</h2><p>Simple management UI for Docker. <a href="https://portainer.readthedocs.io/en/latest/deployment.html" target="_blank" rel="noopener">Deploy Portainer</a> &amp; <a href="https://portainer.readthedocs.io/" target="_blank" rel="noopener">Documentation</a></p>
<ul>
<li><p>Portainer 使用非常簡單。它可以在任何Docker引擎上運行的單個Container（Docker for Linux和Docker for Windows）</p>
</li>
<li><p>Portainer允許管理Docker containers, images, volumes, networks等。它與獨立的Docker引擎和Docker Swarm兼容。</p>
</li>
</ul>
<p><img src="https://i.imgur.com/v1Fx5WR.png" alt></p>
<h2 id><a href="#" class="headerlink" title></a><img src="https://d1jiktx90t87hr.cloudfront.net/354/wp-content/uploads/sites/2/2018/12/endpoints1.png" alt></h2><h3 id="版本限制"><a href="#版本限制" class="headerlink" title="版本限制"></a>版本限制</h3><p>Portainer 支持以下Docker版本：</p>
<ul>
<li>Docker 1.10 to the latest version</li>
<li>Standalone Docker Swarm &gt;= 1.2.3</li>
</ul>
<hr>
<h2 id="部署-Portainer"><a href="#部署-Portainer" class="headerlink" title="部署 Portainer"></a>部署 Portainer</h2><blockquote>
<p>官網安裝方法可<a href="https://portainer.io/install.html" target="_blank" rel="noopener">參考</a> </p>
</blockquote>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker image pull portainer/portainer</span><br><span class="line">$ docker run -d -p 9000:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</span><br></pre></td></tr></table></figure>
<p>創建後即可查看container狀態<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">04811d58f2bc        portainer/portainer   <span class="hljs-string">"/portainer"</span>        26 hours ago        Up 26 hours         0.0.0.0:9000-&gt;9000/tcp   portainer</span><br></pre></td></tr></table></figure></p>
<h2 id="快速生成-TLS-憑證"><a href="#快速生成-TLS-憑證" class="headerlink" title="快速生成 TLS 憑證"></a>快速生成 TLS 憑證</h2><ul>
<li>官網配置教學參考: <a href="https://docs.docker.com/engine/security/https/" target="_blank" rel="noopener">Protect the Docker daemon socket</a></li>
</ul>
<p>由於Docker官網配置細節複雜，找很久相關生成方法，最後找到別人撰寫好的TLS生成<code>shell執行檔</code>，能快速利用 <code>openssl</code> 生成相應的<code>CA key</code>憑證。</p>
<blockquote>
<p><a href="https://my.oschina.net/ykbj/blog/1920021" target="_blank" rel="noopener">Ref: [CoreOS配置Docker API TLS認證]</a></p>
</blockquote>
<p>這邊直接創建以下<code>shell</code>執行檔生成對應 TLS 憑證<code>CA key</code>，執行配置請依照<code>當前環境</code>修改配置後進行執行<code>shell</code>：</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">$ vim auto-tls-certs.sh</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#!/bin/bash</span></span><br><span class="line"><span class="hljs-comment"># </span></span><br><span class="line"><span class="hljs-comment"># -------------------------------------------------------------</span></span><br><span class="line"><span class="hljs-comment"># 自動創建 Docker TLS 憑證</span></span><br><span class="line"><span class="hljs-comment"># -------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 以下是配置信息</span></span><br><span class="line"><span class="hljs-comment"># --[BEGIN]------------------------------</span></span><br><span class="line"></span><br><span class="line">CODE=<span class="hljs-string">"辨識生成key名稱"</span>  </span><br><span class="line">IP=<span class="hljs-string">"節點IP"</span></span><br><span class="line">PASSWORD=<span class="hljs-string">"憑證密碼"</span></span><br><span class="line">COUNTRY=<span class="hljs-string">"TW"</span></span><br><span class="line">STATE=<span class="hljs-string">"Taipei"</span></span><br><span class="line">CITY=<span class="hljs-string">"Taipei"</span></span><br><span class="line">ORGANIZATION=<span class="hljs-string">"公司"</span></span><br><span class="line">ORGANIZATIONAL_UNIT=<span class="hljs-string">"Dev"</span></span><br><span class="line">COMMON_NAME=<span class="hljs-string">"<span class="hljs-variable">$IP</span>"</span></span><br><span class="line">EMAIL=<span class="hljs-string">"service@input.email"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># --[END]--</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Generate CA key</span></span><br><span class="line">openssl genrsa -aes256 -passout <span class="hljs-string">"pass:<span class="hljs-variable">$PASSWORD</span>"</span> -out <span class="hljs-string">"ca-key-<span class="hljs-variable">$CODE</span>.pem"</span> 4096</span><br><span class="line"><span class="hljs-comment"># Generate CA</span></span><br><span class="line">openssl req -new -x509 -days 365 -key <span class="hljs-string">"ca-key-<span class="hljs-variable">$CODE</span>.pem"</span> -sha256 -out <span class="hljs-string">"ca-<span class="hljs-variable">$CODE</span>.pem"</span> -passin <span class="hljs-string">"pass:<span class="hljs-variable">$PASSWORD</span>"</span> -subj <span class="hljs-string">"/C=<span class="hljs-variable">$COUNTRY</span>/ST=<span class="hljs-variable">$STATE</span>/L=<span class="hljs-variable">$CITY</span>/O=<span class="hljs-variable">$ORGANIZATION</span>/OU=<span class="hljs-variable">$ORGANIZATIONAL_UNIT</span>/CN=<span class="hljs-variable">$COMMON_NAME</span>/emailAddress=<span class="hljs-variable">$EMAIL</span>"</span></span><br><span class="line"><span class="hljs-comment"># Generate Server key</span></span><br><span class="line">openssl genrsa -out <span class="hljs-string">"server-key-<span class="hljs-variable">$CODE</span>.pem"</span> 4096</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Generate Server Certs.</span></span><br><span class="line">openssl req -subj <span class="hljs-string">"/CN=<span class="hljs-variable">$COMMON_NAME</span>"</span> -sha256 -new -key <span class="hljs-string">"server-key-<span class="hljs-variable">$CODE</span>.pem"</span> -out server.csr</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">echo</span> <span class="hljs-string">"subjectAltName = IP:<span class="hljs-variable">$IP</span>,IP:127.0.0.1"</span> &gt;&gt; extfile.cnf</span><br><span class="line"><span class="hljs-built_in">echo</span> <span class="hljs-string">"extendedKeyUsage = serverAuth"</span> &gt;&gt; extfile.cnf</span><br><span class="line"></span><br><span class="line">openssl x509 -req -days 365 -sha256 -<span class="hljs-keyword">in</span> server.csr -passin <span class="hljs-string">"pass:<span class="hljs-variable">$PASSWORD</span>"</span> -CA <span class="hljs-string">"ca-<span class="hljs-variable">$CODE</span>.pem"</span> -CAkey <span class="hljs-string">"ca-key-<span class="hljs-variable">$CODE</span>.pem"</span> -CAcreateserial -out <span class="hljs-string">"server-cert-<span class="hljs-variable">$CODE</span>.pem"</span> -extfile extfile.cnf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Generate Client Certs.</span></span><br><span class="line">rm -f extfile.cnf</span><br><span class="line"></span><br><span class="line">openssl genrsa -out <span class="hljs-string">"key-<span class="hljs-variable">$CODE</span>.pem"</span> 4096</span><br><span class="line">openssl req -subj <span class="hljs-string">'/CN=client'</span> -new -key <span class="hljs-string">"key-<span class="hljs-variable">$CODE</span>.pem"</span> -out client.csr</span><br><span class="line"><span class="hljs-built_in">echo</span> extendedKeyUsage = clientAuth &gt;&gt; extfile.cnf</span><br><span class="line">openssl x509 -req -days 365 -sha256 -<span class="hljs-keyword">in</span> client.csr -passin <span class="hljs-string">"pass:<span class="hljs-variable">$PASSWORD</span>"</span> -CA <span class="hljs-string">"ca-<span class="hljs-variable">$CODE</span>.pem"</span> -CAkey <span class="hljs-string">"ca-key-<span class="hljs-variable">$CODE</span>.pem"</span> -CAcreateserial -out <span class="hljs-string">"cert-<span class="hljs-variable">$CODE</span>.pem"</span> -extfile extfile.cnf</span><br><span class="line"></span><br><span class="line">rm -vf client.csr server.csr</span><br><span class="line"></span><br><span class="line">chmod -v 0400 <span class="hljs-string">"ca-key-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"key-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"server-key-<span class="hljs-variable">$CODE</span>.pem"</span></span><br><span class="line">chmod -v 0444 <span class="hljs-string">"ca-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"server-cert-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"cert-<span class="hljs-variable">$CODE</span>.pem"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 打包 client 憑證</span></span><br><span class="line">mkdir -p <span class="hljs-string">"tls-client-certs-<span class="hljs-variable">$CODE</span>"</span></span><br><span class="line">cp -f <span class="hljs-string">"ca-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"cert-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"key-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"tls-client-certs-<span class="hljs-variable">$CODE</span>/"</span></span><br><span class="line"><span class="hljs-built_in">cd</span> <span class="hljs-string">"tls-client-certs-<span class="hljs-variable">$CODE</span>"</span></span><br><span class="line">tar zcf <span class="hljs-string">"tls-client-certs-<span class="hljs-variable">$CODE</span>.tar.gz"</span> *</span><br><span class="line">mv <span class="hljs-string">"tls-client-certs-<span class="hljs-variable">$CODE</span>.tar.gz"</span> ../</span><br><span class="line"><span class="hljs-built_in">cd</span> ..</span><br><span class="line">rm -rf <span class="hljs-string">"tls-client-certs-<span class="hljs-variable">$CODE</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 拷貝服務憑證</span></span><br><span class="line">mkdir -p /etc/docker/certs.d</span><br><span class="line">cp <span class="hljs-string">"ca-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"server-cert-<span class="hljs-variable">$CODE</span>.pem"</span> <span class="hljs-string">"server-key-<span class="hljs-variable">$CODE</span>.pem"</span> /etc/docker/certs.d/</span><br></pre></td></tr></table></figure>
<p>腳本執行完成後顯示訊息：<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ ./create_ca_key.sh </span><br><span class="line"></span><br><span class="line">Generating RSA private key, 4096 bit long modulus</span><br><span class="line">......................................................++</span><br><span class="line">.........................................................................................................................++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Generating RSA private key, 4096 bit long modulus</span><br><span class="line">......................................................++</span><br><span class="line">..............++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Signature ok</span><br><span class="line">subject=/CN=140.128.18.88</span><br><span class="line">Getting CA Private Key</span><br><span class="line">Generating RSA private key, 4096 bit long modulus</span><br><span class="line">....................................................................................................................++</span><br><span class="line">..............................................++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">Signature ok</span><br><span class="line">subject=/CN=client</span><br><span class="line">Getting CA Private Key</span><br><span class="line">removed <span class="hljs-string">'client.csr'</span></span><br><span class="line">removed <span class="hljs-string">'server.csr'</span></span><br><span class="line">mode of <span class="hljs-string">'ca-key-s1.pem'</span> changed from 0644 (rw-r--r--) to 0400 (r--------)</span><br><span class="line">mode of <span class="hljs-string">'key-s1.pem'</span> changed from 0644 (rw-r--r--) to 0400 (r--------)</span><br><span class="line">mode of <span class="hljs-string">'server-key-s1.pem'</span> changed from 0644 (rw-r--r--) to 0400 (r--------)</span><br><span class="line">mode of <span class="hljs-string">'ca-s1.pem'</span> changed from 0644 (rw-r--r--) to 0444 (r--r--r--)</span><br><span class="line">mode of <span class="hljs-string">'server-cert-s1.pem'</span> changed from 0644 (rw-r--r--) to 0444 (r--r--r--)</span><br><span class="line">mode of <span class="hljs-string">'cert-s1.pem'</span> changed from 0644 (rw-r--r--) to 0444 (r--r--r--)</span><br></pre></td></tr></table></figure></p>
<p>對腳本中配置參數進行修改後運行，自動會生成TLS憑證，在/etc/docker/certs.d/目錄下:</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls /etc/docker/certs.d/</span><br><span class="line">ca-dp.pem  ca-s1.pem  server-cert-dp.pem  server-cert-s1.pem  server-key-dp.pem  server-key-s1.pem</span><br></pre></td></tr></table></figure>
<p>其中運行<code>shell腳本</code>的路徑下，同時還會自動壓縮好了一個<code>.tar.gz</code>檔，方便我們認證使用。</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">tls-client-certs-s1.tar.gz ca-key-s1.pem  ca-s1.pem  ca-s1.srl  cert-s1.pem  create_ca_key.sh  extfile.cnf  key-s1.pem  server-cert-s1.pem  server-key-s1.pem</span><br></pre></td></tr></table></figure>
<p>這邊<code>Portainer UI</code> 直接透過<code>tls-client-certs-{CODE}.tar.gz</code>這個壓縮檔裡面<code>CA Key</code>進行 <code>Portainer TLS</code>認證。</p>
<hr>
<h2 id="新增-Endpoints-主機並配置TLS"><a href="#新增-Endpoints-主機並配置TLS" class="headerlink" title="新增 Endpoints 主機並配置TLS"></a>新增 Endpoints 主機並配置TLS</h2><p>在使用 <code>portainer</code> 管理Docker主機，為了安全性關係新增 Endpoints 時，需要開啟 TLS 認證，上傳 docker-mahcine 部署主機的憑證和key：</p>
<ul>
<li><code>TLS CA certificate</code>：ca.pem</li>
<li><code>TLS certificate</code>：cert.pem</li>
<li><code>TLS key</code>：key.pem</li>
</ul>
<h3 id="開啟Remote-API訪問"><a href="#開啟Remote-API訪問" class="headerlink" title="開啟Remote API訪問"></a>開啟Remote API訪問</h3><p>首先確認，TLS 生成出來憑證 <code>ca.pem</code>,<code>cert.pem</code>,<code>key.pem</code> 路徑，環境實驗路徑<code>/root/private/</code>。</p>
<h4 id="修改docker啟動文件"><a href="#修改docker啟動文件" class="headerlink" title="修改docker啟動文件"></a>修改docker啟動文件</h4><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim  /lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure>
<h4 id="修改ExecStart配置參數"><a href="#修改ExecStart配置參數" class="headerlink" title="修改ExecStart配置參數"></a>修改ExecStart配置參數</h4><ul>
<li>新增<code>-H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock</code></li>
<li>依照路徑對應 <code>ca.pem</code>, <code>cert.pem</code>, <code>key.pem</code> 配置</li>
</ul>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=/usr/bin/dockerd  -H unix://var/run/docker.sock -D -H tcp://0.0.0.0:2375 --tlsverify --tlscacert=/root/ca-dp.pem --tlscert=/root/server-cert-dp.pem --tlskey=/root/server-key-dp.pem</span><br></pre></td></tr></table></figure>
<h4 id="portainer-指令說明"><a href="#portainer-指令說明" class="headerlink" title="portainer 指令說明"></a>portainer 指令說明</h4><blockquote>
<ul>
<li>–tlsverify: TLS support (default: false)<br>–tlscacert: Path to the CA (default: /certs/ca.pem on Linux）<br>–tlscert: Path to the TLS certificate file (default: /certs/cert.pem）<br>–tlskey: Path to the TLS key (default: /certs/key.pem, </li>
</ul>
</blockquote>
<p>配置好後重啟 Docker<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">重新啟動 docker</span><br><span class="line">$ systemctl restart  docker</span><br><span class="line"></span><br><span class="line">檢查 參數</span><br><span class="line">$ ps -ef  | grep docker</span><br><span class="line"></span><br><span class="line">$ ps -ef  | grep docker</span><br><span class="line">root     18434     1  2 16:54 ?        00:00:00 /usr/bin/dockerd -H unix://var/run/docker.sock -D -H tcp://0.0.0.0:2375 --tlsverify --tlscacert=/root/private/ca-s1.pem --tlscert=/root/private/server-cert-s1.pem --tlskey=/root/private/server-key-s1.pem</span><br><span class="line">root     18558 15435  0 16:54 pts/0    00:00:00 grep --color=auto docker</span><br></pre></td></tr></table></figure></p>
<h4 id="補充-測試TLS認證"><a href="#補充-測試TLS認證" class="headerlink" title="#補充: 測試TLS認證"></a>#補充: 測試TLS認證</h4><p>將<code>cert.pem</code>,<code>key.pem</code>這兩個檔案複製到測試機上,透過 curl中<code>-k</code>意思是(Allow connections to SSL sites without certs)驗證憑證</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -k https://&#123;docker節點IP&#125;:2375/info --cert ./cert.pem --key ./key.pem</span><br></pre></td></tr></table></figure>
<p>返回docker信息即為完成憑證認證</p>
<figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -k https://140.128.18.88:2375/info --cert cert-dp.pem --key key-dp.pem </span><br><span class="line">&#123;<span class="hljs-string">"ID"</span>:<span class="hljs-string">"F2HY:7GDT:YA3J:74UZ:2AKP:GW2Z:MIIT:GPG3:NOHZ:EKCW:ZFCA:M575"</span>,<span class="hljs-string">"Containers"</span>:2,<span class="hljs-string">"ContainersRunning"</span>:1,<span class="hljs-string">"ContainersPaused"</span>:0,<span class="hljs-string">"ContainersStopped"</span>:1,<span class="hljs-string">"Images"</span>:22,<span class="hljs-string">"Driver"</span>:<span class="hljs-string">"overlay2"</span>,<span class="hljs-string">"DriverStatus"</span>:[[<span class="hljs-string">"Backing Filesystem"</span>,<span class="hljs-string">"extfs"</span>],[<span class="hljs-string">"Supports d_type"</span>,<span class="hljs-string">"true"</span>],[<span class="hljs-string">"Native Overlay Diff"</span>,<span class="hljs-string">"true"</span>]],<span class="hljs-string">"SystemStatus"</span>:null,<span class="hljs-string">"Plugins"</span>:&#123;<span class="hljs-string">"Volume"</span>:[<span class="hljs-string">"local"</span>],<span class="hljs-string">"Network"</span>:[<span class="hljs-string">"bridge"</span>,<span class="hljs-string">"host"</span>,<span class="hljs-string">"macvlan"</span>,<span class="hljs-string">"null"</span>,<span class="hljs-string">"overlay"</span>],<span class="hljs-string">"Authorization"</span>:null,<span class="hljs-string">"Log"</span>:[<span class="hljs-string">"awslogs"</span>,<span class="hljs-string">"fluentd"</span>,<span class="hljs-string">"gcplogs"</span>,<span class="hljs-string">"gelf"</span>,<span class="hljs-string">"journald"</span>,<span class="hljs-string">"json-file"</span>,<span class="hljs-string">"local"</span>,<span class="hljs-string">"logentries"</span>,<span class="hljs-string">"splunk"</span>,<span class="hljs-string">"syslog"</span>]&#125;,<span class="hljs-string">"MemoryLimit"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"SwapLimit"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"KernelMemory"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"CpuCfsPeriod"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"CpuCfsQuota"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"CPUShares"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"CPUSet"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"IPv4Forwarding"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"BridgeNfIptables"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"BridgeNfIp6tables"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"Debug"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"NFd"</span>:31,<span class="hljs-string">"OomKillDisable"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"NGoroutines"</span>:44,<span class="hljs-string">"SystemTime"</span>:<span class="hljs-string">"2019-01-28T15:26:15.584473249+08:00"</span>,<span class="hljs-string">"LoggingDriver"</span>:<span class="hljs-string">"json-file"</span>,<span class="hljs-string">"CgroupDriver"</span>:<span class="hljs-string">"cgroupfs"</span>,<span class="hljs-string">"NEventsListener"</span>:0,<span class="hljs-string">"KernelVersion"</span>:<span class="hljs-string">"4.13.0-36-generic"</span>,<span class="hljs-string">"OperatingSystem"</span>:<span class="hljs-string">"Ubuntu 16.04.4 LTS"</span>,<span class="hljs-string">"OSType"</span>:<span class="hljs-string">"linux"</span>,<span class="hljs-string">"Architecture"</span>:<span class="hljs-string">"x86_64"</span>,<span class="hljs-string">"IndexServerAddress"</span>:<span class="hljs-string">"https://index.docker.io/v1/"</span>,<span class="hljs-string">"RegistryConfig"</span>:&#123;<span class="hljs-string">"AllowNondistributableArtifactsCIDRs"</span>:[],<span class="hljs-string">"AllowNondistributableArtifactsHostnames"</span>:[],<span class="hljs-string">"InsecureRegistryCIDRs"</span>:[<span class="hljs-string">"127.0.0.0/8"</span>],<span class="hljs-string">"IndexConfigs"</span>:&#123;<span class="hljs-string">"docker.io"</span>:&#123;<span class="hljs-string">"Name"</span>:<span class="hljs-string">"docker.io"</span>,<span class="hljs-string">"Mirrors"</span>:[],<span class="hljs-string">"Secure"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"Official"</span>:<span class="hljs-literal">true</span>&#125;&#125;,<span class="hljs-string">"Mirrors"</span>:[]&#125;,<span class="hljs-string">"NCPU"</span>:4,<span class="hljs-string">"MemTotal"</span>:16739332096,<span class="hljs-string">"GenericResources"</span>:null,<span class="hljs-string">"DockerRootDir"</span>:<span class="hljs-string">"/var/lib/docker"</span>,<span class="hljs-string">"HttpProxy"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"HttpsProxy"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"NoProxy"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"Name"</span>:<span class="hljs-string">"lab506-s1"</span>,<span class="hljs-string">"Labels"</span>:[],<span class="hljs-string">"ExperimentalBuild"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"ServerVersion"</span>:<span class="hljs-string">"18.09.1"</span>,<span class="hljs-string">"ClusterStore"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"ClusterAdvertise"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"Runtimes"</span>:&#123;<span class="hljs-string">"nvidia"</span>:&#123;<span class="hljs-string">"path"</span>:<span class="hljs-string">"nvidia-container-runtime"</span>&#125;,<span class="hljs-string">"runc"</span>:&#123;<span class="hljs-string">"path"</span>:<span class="hljs-string">"runc"</span>&#125;&#125;,<span class="hljs-string">"DefaultRuntime"</span>:<span class="hljs-string">"runc"</span>,<span class="hljs-string">"Swarm"</span>:&#123;<span class="hljs-string">"NodeID"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"NodeAddr"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"LocalNodeState"</span>:<span class="hljs-string">"inactive"</span>,<span class="hljs-string">"ControlAvailable"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"Error"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"RemoteManagers"</span>:null&#125;,<span class="hljs-string">"LiveRestoreEnabled"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"Isolation"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"InitBinary"</span>:<span class="hljs-string">"docker-init"</span>,<span class="hljs-string">"ContainerdCommit"</span>:&#123;<span class="hljs-string">"ID"</span>:<span class="hljs-string">"9754871865f7fe2f4e74d43e2fc7ccd237edcbce"</span>,<span class="hljs-string">"Expected"</span>:<span class="hljs-string">"9754871865f7fe2f4e74d43e2fc7ccd237edcbce"</span>&#125;,<span class="hljs-string">"RuncCommit"</span>:&#123;<span class="hljs-string">"ID"</span>:<span class="hljs-string">"96ec2177ae841256168fcf76954f7177af9446eb"</span>,<span class="hljs-string">"Expected"</span>:<span class="hljs-string">"96ec2177ae841256168fcf76954f7177af9446eb"</span>&#125;,<span class="hljs-string">"InitCommit"</span>:&#123;<span class="hljs-string">"ID"</span>:<span class="hljs-string">"fec3683"</span>,<span class="hljs-string">"Expected"</span>:<span class="hljs-string">"fec3683"</span>&#125;,<span class="hljs-string">"SecurityOptions"</span>:[<span class="hljs-string">"name=apparmor"</span>,<span class="hljs-string">"name=seccomp,profile=default"</span>],<span class="hljs-string">"ProductLicense"</span>:<span class="hljs-string">"Community Engine"</span>,<span class="hljs-string">"Warnings"</span>:[<span class="hljs-string">"WARNING: No swap limit support"</span>]&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完成後配置遠端節點-Endpoints"><a href="#完成後配置遠端節點-Endpoints" class="headerlink" title="完成後配置遠端節點 Endpoints"></a>完成後配置遠端節點 Endpoints</h3><p>Portainer透過上傳CA key，這邊直接解壓縮<code>shell</code>生成<code>tls-client-certs-{CODE}.tar.gz</code>的壓縮檔直接加入對應的TLS。</p>
<p><img src="https://i.imgur.com/Ip80daq.png" alt></p>
<hr>
<h2 id="設置-docker默認-runtime-為-nvidia"><a href="#設置-docker默認-runtime-為-nvidia" class="headerlink" title="設置 docker默認 runtime 為 nvidia"></a>設置 docker默認 runtime 為 nvidia</h2><p>由於環境Portainer預設執行為<code>docker runtime</code>，導致如果啟動Nvidia-Docker所執行的GPU Container會無法使用，這邊 Docker default runtime 改成 nvidia。</p>
<p>新增<code>&quot;default-runtime&quot;: &quot;nvidia&quot;</code>指派配置，直接用docker取代nvidia-docker。<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-string">"default-runtime"</span>: <span class="hljs-string">"nvidia"</span>,</span><br><span class="line">    <span class="hljs-string">"runtimes"</span>: &#123;</span><br><span class="line">        <span class="hljs-string">"nvidia"</span>: &#123;</span><br><span class="line">            <span class="hljs-string">"path"</span>: <span class="hljs-string">"/usr/bin/nvidia-container-runtime"</span>,</span><br><span class="line">            <span class="hljs-string">"runtimeArgs"</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>完成後儲存，並重新啟動 Docker：<br><figure class="highlight bash hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker</span><br></pre></td></tr></table></figure></p>
<p>Portainer 即可正常創建GPU Container: </p>
<p><img src="https://i.imgur.com/4bddhEY.png" alt></p>
<p><img src="https://i.imgur.com/KGj02Bu.png" alt></p>
<hr>
<h2 id="Related-Posts"><a href="#Related-Posts" class="headerlink" title="Related Posts"></a>Related Posts</h2><ul>
<li><a href="http://sakananote2.blogspot.com/2018/06/portainer-with-opensuse-leap-15.html" target="_blank" rel="noopener">[Portainer with openSUSE Leap 15 小記]</a></li>
<li><a href="https://my.oschina.net/ykbj/blog/1920021" target="_blank" rel="noopener">[CoreOS配置Docker API TLS认证]]</a></li>
<li><a href="https://hk.saowen.com/a/5e0307008b31189c6923c4ede3a8fca83742cb1dd63a57c0fd4cf72233c791b2" target="_blank" rel="noopener">[ docker 開啟remote api訪問，並使用TLS加密]</a></li>
</ul>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/UI/">UI</a>, <a class="has-link-grey -link" href="/tags/docker/">docker</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜歡這篇文章嗎? 贊助一下作者吧!</h3>
        <div class="buttons is-centered">
            
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2019/02/03/kubeflow-0-4-release/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Kubeflow v0.4.x 部署與概述</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2019/01/22/kubeflow-job-scheduling/">
                <span class="level-item">如何更換 Kubeflow 預設 Scheduling</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">評論</h3>
        
<script>
    var disqus_config = function () {
        this.page.url = 'http://yylin1.github.io/2019/01/28/portainer-set-tls/';
        this.page.identifier = '2019/01/28/portainer-set-tls/';
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'yylin' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </div>
</div>
</div>
                

<!-- 粘贴的部分 -->

<!-- 修改，可选保留的栏 -->




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-3 column-left ">
    
    
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/yiyang.png" alt="Yi Yang">
                    
                    
                    <p class="is-size-4 is-block">
                        Yi Yang
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Software Engineer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Hsinchu, Taiwan</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        20
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分類
                    </p>
                    <p class="title has-text-weight-normal">
                        10
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        標籤
                    </p>
                    <p class="title has-text-weight-normal">
                        23
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/yylin1" target="_blank">
                追蹤</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/yylin1">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Facebook" href="https://facebook.com/frank.yiyanglin">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Envelope" href="mailto:frank.yylin@gmail.com">
                
                <i class="far fa-envelope"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
    
<div class="card widget" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                文章目錄
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#Portainer概述">
        <span class="has-mr-6">1</span>
        <span>Portainer概述</span>
        </a></li><li>
        <a class="is-flex" href="#">
        <span class="has-mr-6">2</span>
        <span></span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#版本限制">
        <span class="has-mr-6">2.1</span>
        <span>版本限制</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#部署-Portainer">
        <span class="has-mr-6">3</span>
        <span>部署 Portainer</span>
        </a></li><li>
        <a class="is-flex" href="#快速生成-TLS-憑證">
        <span class="has-mr-6">4</span>
        <span>快速生成 TLS 憑證</span>
        </a></li><li>
        <a class="is-flex" href="#新增-Endpoints-主機並配置TLS">
        <span class="has-mr-6">5</span>
        <span>新增 Endpoints 主機並配置TLS</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#開啟Remote-API訪問">
        <span class="has-mr-6">5.1</span>
        <span>開啟Remote API訪問</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#修改docker啟動文件">
        <span class="has-mr-6">5.1.1</span>
        <span>修改docker啟動文件</span>
        </a></li><li>
        <a class="is-flex" href="#修改ExecStart配置參數">
        <span class="has-mr-6">5.1.2</span>
        <span>修改ExecStart配置參數</span>
        </a></li><li>
        <a class="is-flex" href="#portainer-指令說明">
        <span class="has-mr-6">5.1.3</span>
        <span>portainer 指令說明</span>
        </a></li><li>
        <a class="is-flex" href="#補充-測試TLS認證">
        <span class="has-mr-6">5.1.4</span>
        <span>#補充: 測試TLS認證</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#完成後配置遠端節點-Endpoints">
        <span class="has-mr-6">5.2</span>
        <span>完成後配置遠端節點 Endpoints</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#設置-docker默認-runtime-為-nvidia">
        <span class="has-mr-6">6</span>
        <span>設置 docker默認 runtime 為 nvidia</span>
        </a></li><li>
        <a class="is-flex" href="#Related-Posts">
        <span class="has-mr-6">7</span>
        <span>Related Posts</span>
        </a></li></ul>
        </div>
    </div>
</div>

    
    

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            連結
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://chlin62.github.io/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">不平凡的林大工程師</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">chlin62.github.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://franksm.github.io/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">是孟非夢之奮鬥好夥伴</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">franksm.github.io</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
    
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分類
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Ansible/">
            <span class="level-start">
                <span class="level-item">Ansible</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Deploy/">
            <span class="level-start">
                <span class="level-item">Deploy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Docker/">
            <span class="level-start">
                <span class="level-item">Docker</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Driver/">
            <span class="level-start">
                <span class="level-item">Driver</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Kubeflow/">
            <span class="level-start">
                <span class="level-item">Kubeflow</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Kubernetes/">
            <span class="level-start">
                <span class="level-item">Kubernetes</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Linkpack/">
            <span class="level-start">
                <span class="level-item">Linkpack</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Note/">
            <span class="level-start">
                <span class="level-item">Note</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Openshift/">
            <span class="level-start">
                <span class="level-item">Openshift</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Zabbix/">
            <span class="level-start">
                <span class="level-item">Zabbix</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
    
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            標籤雲
        </h3>
        <a href="/tags/API/" style="font-size: 12.5px;">API</a> <a href="/tags/GPU/" style="font-size: 15px;">GPU</a> <a href="/tags/NVIDIA-Driver/" style="font-size: 12.5px;">NVIDIA Driver</a> <a href="/tags/Retrospect/" style="font-size: 15px;">Retrospect</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/ansible/" style="font-size: 15px;">ansible</a> <a href="/tags/bastion/" style="font-size: 10px;">bastion</a> <a href="/tags/benchmark/" style="font-size: 10px;">benchmark</a> <a href="/tags/deploy/" style="font-size: 17.5px;">deploy</a> <a href="/tags/distributed/" style="font-size: 10px;">distributed</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/kubecon/" style="font-size: 10px;">kubecon</a> <a href="/tags/kubeflow/" style="font-size: 20px;">kubeflow</a> <a href="/tags/kubernetes/" style="font-size: 20px;">kubernetes</a> <a href="/tags/linpack/" style="font-size: 10px;">linpack</a> <a href="/tags/microk8s/" style="font-size: 12.5px;">microk8s</a> <a href="/tags/minikube/" style="font-size: 10px;">minikube</a> <a href="/tags/openshift/" style="font-size: 12.5px;">openshift</a> <a href="/tags/parmeter-server/" style="font-size: 10px;">parmeter server</a> <a href="/tags/quickstart/" style="font-size: 10px;">quickstart</a> <a href="/tags/scheduler/" style="font-size: 10px;">scheduler</a> <a href="/tags/ubuntu/" style="font-size: 12.5px;">ubuntu</a> <a href="/tags/zabbix/" style="font-size: 12.5px;">zabbix</a>
    </div>
</div>

    
    
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/12/31/2019-retrospect-prospect/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/2019_end.png" alt="2019 年度總結">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-31T03:50:00.000Z">2019-12-31</time></div>
                    <a href="/2019/12/31/2019-retrospect-prospect/" class="has-link-black-ter is-size-6">2019 年度總結</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/10/12/roca12day/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/roca12.jpg" alt="中坑精南 補充兵 12 日心得">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-12T06:38:05.000Z">2019-10-12</time></div>
                    <a href="/2019/10/12/roca12day/" class="has-link-black-ter is-size-6">中坑精南 補充兵 12 日心得</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/08/12/openshift-ansible-v3-11/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/openshift 3.11.jpg" alt="透過 Ansible 快速部署 OpenShift 3.11(OKD) 叢集">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-12T15:41:13.000Z">2019-08-12</time></div>
                    <a href="/2019/08/12/openshift-ansible-v3-11/" class="has-link-black-ter is-size-6">透過 Ansible 快速部署 OpenShift 3.11(OKD) 叢集</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Openshift/">Openshift</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/05/03/minikube-for-kubeflow/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/minikube_for_kubeflow.jpg" alt="利用 Minikube 快速測試部署 Kubeflow v0.5">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-05-03T15:46:54.000Z">2019-05-03</time></div>
                    <a href="/2019/05/03/minikube-for-kubeflow/" class="has-link-black-ter is-size-6">利用 Minikube 快速測試部署 Kubeflow v0.5</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Kubeflow/">Kubeflow</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/02/03/kubeflow-0-4-release/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/kubeflow-deploy-0-4.png" alt="Kubeflow v0.4.x 部署與概述">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-02-03T05:28:29.000Z">2019-02-03</time></div>
                    <a href="/2019/02/03/kubeflow-0-4-release/" class="has-link-black-ter is-size-6">Kubeflow v0.4.x 部署與概述</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Kubeflow/">Kubeflow</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
    
    <div class="column-right-shadow is-hidden-widescreen ">
        
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            彙整
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">八月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/10/">
                <span class="level-start">
                    <span class="level-item">十月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                標籤
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/API/">
                        <span class="tag">API</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/GPU/">
                        <span class="tag">GPU</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/NVIDIA-Driver/">
                        <span class="tag">NVIDIA Driver</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Retrospect/">
                        <span class="tag">Retrospect</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UI/">
                        <span class="tag">UI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ansible/">
                        <span class="tag">ansible</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bastion/">
                        <span class="tag">bastion</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/benchmark/">
                        <span class="tag">benchmark</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/deploy/">
                        <span class="tag">deploy</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/distributed/">
                        <span class="tag">distributed</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/docker/">
                        <span class="tag">docker</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kubecon/">
                        <span class="tag">kubecon</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kubeflow/">
                        <span class="tag">kubeflow</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/kubernetes/">
                        <span class="tag">kubernetes</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linpack/">
                        <span class="tag">linpack</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/microk8s/">
                        <span class="tag">microk8s</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/minikube/">
                        <span class="tag">minikube</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/openshift/">
                        <span class="tag">openshift</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/parmeter-server/">
                        <span class="tag">parmeter server</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/quickstart/">
                        <span class="tag">quickstart</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/scheduler/">
                        <span class="tag">scheduler</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ubuntu/">
                        <span class="tag">ubuntu</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/zabbix/">
                        <span class="tag">zabbix</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
    </div>
    
</div>


                

<!-- 粘贴的部分 -->


            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/artificial-intelligence.png" alt="Portainer 透過 TLS 認證" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Yi Yang&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                &nbsp;<i class="fa fa-user-md"></i> 本站瀏覽人數<span id="busuanzi_value_site_uv"></span>人
                </p>
                        <!--
                
                </p>
                -->
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-TW");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到頁首" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="請輸入關鍵字...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '頁面',
                CATEGORIES: '分類',
                TAGS: '標籤',
                UNTITLED: '(無標題)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>
